<h2>gmap</h2>
<!--地名入力 -->
<input id="address" type="textbox" value="">
<!-- buttonクリックでcodeAddress実行 -->
<input type="button" value="Encode" onclick="codeAddress()">

<button onclick="getLocation()">取得!!!</button>

<div id='map'></div>

<style>
#map{
  height: 600px;
}
</style>

<script>

let map
var geocoder
var marker = [];
var infoWindow = [];
var center = { lat: 35.700, lng: 139.000 };

function initMap(){
  geocoder = new google.maps.Geocoder() //geocoderを初期化

  map = new google.maps.Map(document.getElementById('map'), {
  center: center,
  zoom: 8
    });

  <% @camp_sites.each do |camp_site, i| %>
      var test = {lat: <%= camp_site.latitude %>, lng: <%= camp_site.longitude %>};
     marker[<%= camp_site.id %>] = new google.maps.Marker({
        map: map,
        position: test,
      });
  infoWindow[<%= camp_site.id %>] = new google.maps.InfoWindow({
        content: '<div class="sample"><%= link_to camp_site.name, camp_site_path(camp_site.id) %></div>'
      });
  marker[<%= camp_site.id %>].addListener('click', function(){
    infoWindow[<%= camp_site.id %>].open(map, marker[<%= camp_site.id %>]);
      });
  <% end %>
}

//検索時
function codeAddress(){
//入力を取得
  let inputAddress =document.getElementById('address').value;

//geocodingした後にmapを移動
  geocoder.geocode( {'address': inputAddress }, function(results, status){
    if (status == 'OK'){
//map.setCenterで地図移動
      map.setCenter(results[0].geometry.location);
//マーカー立つ
      var marker = new google.maps.Marker({
      map: map,
      position: results[0].geometry.location
      });
    }else{
      alert('Geocode was not successful for the following readon: ' + status);
    }
  });
}

</script>



<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCsCJhG5dejpV82VY5PzaZG84RRqwFs2Y0&callback=initMap" async defer></script>
